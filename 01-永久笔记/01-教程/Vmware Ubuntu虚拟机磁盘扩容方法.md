---
created: 2023-07-08T20:33
updated: 2024-06-02T21:40
tags:
  - 笔记
  - 笔记/教程
  - 笔记/永久笔记
---

1. 首先将要扩容磁盘的ubuntu虚拟机关闭，如下所示，这个ubuntu虚拟机只有一块20G的硬盘，我们给它扩展为30G。处于关机状态后，点击编辑虚拟机设置。

   ![image-20230220161924082](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201619171.png)

2. 然后在设置界面点击要扩展的硬盘，右边会出现磁盘实用工具。点击下面的扩展按钮。

   ![image-20230220161939040](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201619113.png)

3. 这个时候会弹出新窗口，让你输入新硬盘大小。输入30G，然后点击扩展。它就扩展成功了，会提示你需要进系统进行分区。点击确定保存。

   ![image-20230220161950475](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201619545.png)

4. 重新将ubuntu虚拟机开机，然后打开terminal终端。使用命令：

   df -h 

   查看硬盘信息，可以看到唯一的硬盘/dev/sda1还是18G（另外2G划做缓存空间了），我们需要将增加的10G空间添加到它上面。

   ![image-20230220162002876](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201620947.png)

5. 警告!!!!

   下面的操作会有丢失虚拟机数据的风险，因此建议你在做下面的操作之前，先点击vmware软件界面上的添加快照功能给你的虚拟机创建一个快照。这样后面的操作失败了，也可以一键回到操作之前的环境。

   ![image-20230220162015683](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201620747.png)

6. 使用命令：

   sudo fdisk /dev/sda

   打开硬盘/dev/sda，然后输入子命令p，可以看到对应的硬盘信息，如第二张图中所示，可以看到这块硬盘分为3个部分，分别/dev/sda1，挂载的是我们的ubuntu系统根目录，/dev/sda2，扩展分区。/dev/sda5，交换分区。

   ![image-20230220162027508](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201620596.png)

7. 然后我们输入q命令退出fdisk操作界面，输入命令：

   sudo swapoff /dev/sda5

   来关闭交换分区，然后再输入命令：

   sudo fdisk /dev/sda5

   进入到fdisk操作界面。

   ![image-20230220162045444](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201620508.png)

8. 下面的操作就是风险操作了，使用d命令依次删除这3个分区。如下所示：

   

   ![image-20230220162103326](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201621406.png)

   

9. 

   3个分区都删除完成后，我们来创建新分区。命令依次是:

   n

   p

   回车

   +28G

   然后28G的根分区创建完毕，如下所示：

   

   ![image-20230220162113895](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201621964.png)

10. 根分区创建完毕后，我们再来创建新的交换分区，首先创建扩展分区，命令依次是：

    n

    e

    回车

    回车

    将剩下的2G空间创建为了扩展分区。

    

    ![image-20230220162125635](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201621714.png)

11. 在扩展分区的基础上再创建交换分区，命令依次是：

    n

    回车

    回车

    回车

    逻辑分区创建完毕，这个时候逻辑分区格式是linux，还不是想要的swap分区，需要修改它的分区标志。输入命令t，然后选择分区5，输入分区编号82，就将/dev/sda5从linux格式分区修改为swap类型分区。如下面第二张图中所示。

    

    ![image-20230220162135885](C:/Users/wsf/AppData/Roaming/Typora/typora-user-images/image-20230220162135885.png)

12. 修改完成后，输入p命令查看一下分区信息，如下所示，和编辑之前唯一的区别就是根分区从18G变成了28G，其他没有任何变化。

    确认无误后，输入命令a，然后输入分区编号1，将分区1设置为启动分区。如下面第二张图中所示，最后输入w命令保存配置。这个时候会提示Deivce or resource are busy，是因为原来的根目录还在挂载中，但是没有影响。

    

    ![image-20230220162147359](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201621450.png)

13. 执行重启命令：

    sudo reboot

    重启操作系统，耐心等待系统重启，可能会花费比平时启动更多的时间，等待即可。

    

    ![image-20230220162157848](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201621902.png)

14. 启动完成后，执行命令：

    sudo resize2fs /dev/sda1

    命令执行成功后，输入命令：

    df -h 

    查看硬盘挂载信息，这个时候看到的已经是28G的根目录了，没有任何错误，完美的将虚拟机硬盘扩大了。如下面第二张图中所示：

    ![image-20230220162213802](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302201622897.png)

    

