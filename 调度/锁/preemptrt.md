---
created: 2023-07-08T20:33
updated: 2024-02-13T22:37
tags:
  - 笔记
  - 笔记/学习笔记
---

# 锁

自旋锁表示一种锁定机制，其中迭代地尝试获取锁定，直到成功执行为止。如果锁已经被另一个线程持有，这种行为也会发生，导致当前线程继续“旋转”，浪费 CPU 时间，并抑制被抢占的可能性。虽然这种机制听起来可能不是很有效，但是如果等待时间很短，总体性能，尤其是响应时间，可以从中受益。

除了前面章节中描述的功能外，PREEMPT_RT补丁最重要的附加功能是删除了大多数不可预见的自旋锁。所有实时功能都可以通过CONFIG_PREEMPT_RT_FULL配置标志启用。应用并启用了实时补丁后，spinlock_t和rwlock_t类型是可接受的，而raw_spinlock_t的行为类似于普通的spinlock。spinlock_t和raw_spinlock_t之间的区别在2.6.33版（2010年2月）的主线中通过spinlock注释引入。

所有休眠互斥锁都被实现优先级继承的rt_mutex类型以及信号量所取代。该补丁显著提高了内核的可抢占性，使中断处理程序的上半部分和raw_spinlock_t保护的关键区域成为唯一不可抢占的部分。这增加了系统的响应时间，减少了延迟并提高了可预测性。然而，它增加了上下文切换和资源争用的数量，从而降低了吞吐量，如下一节所述。此外，作为一种负面影响，它增加了优先级反转的可能性。优先级继承和上限协议也可用于用户空间级互斥锁，可通过PTHREAD_PRIO_INHERIT和PTHREAD_BRIO_PROTECT POSIX选项进行配置。