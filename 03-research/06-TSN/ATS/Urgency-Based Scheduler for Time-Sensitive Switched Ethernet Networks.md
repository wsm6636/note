---
created: 2023-10-17T22:56
updated: 2024-03-26T23:33
tags:
  - 笔记
  - 笔记/文献笔记
---

# Urgency-Based Scheduler for Time-Sensitive Switched Ethernet Networks
# 基于紧急程度的时间敏感型交换以太网络调度算法

| Title                 | Urgency-Based Scheduler for Time-Sensitive Switched Ethernet Networks |
| --------------------- | --------------------------------------------------------------------- |
| Journal or Conference | 2016 28th Euromicro Conference on Real-Time Systems (ECRTS)           |
| Authors               | Johannes Specht; Soheil Samii                                         |
| Pub. date             | 7/2016                                                                |
| DOI                   | [10.1109/ECRTS.2016.27](https://doi.org/10.1109/ECRTS.2016.27)        |
| Level                 |                                                                       |

## 摘要
在汽车、航空电子、工业控制等嵌入式系统应用领域，由于对带宽要求的不断提高，以太网技术应运而生。在汽车领域，以太网实现了摄像头、雷达和融合的集成，以构建主动安全和自动驾驶系统。虽然以太网提供了必要的通信带宽，但需要解决方案来满足此类安全关键型系统的严格可靠性和临时要求。本文介绍了一种异步业务调度算法，该算法在保证低时延的同时，保持了较低的实现复杂度。我们给出了时序分析，并通过大量的仿真实验证明了延迟界的紧密性。
## 引言

在许多分布式、实时和安全关键应用领域中，当前的网络技术在支持日益增长的通信带宽需求方面正在达到它们的极限。<span style="color:black;background:#d59e83 !important;">以汽车系统领域为例，通信协议CAN[1]、CAN-FD[2]和FlexRay[3]通常分别以0.5、2和10Mbit/S的速率运行。新兴的汽车应用和用例，如高级驾驶辅助系统(ADAS)、自动驾驶和信息娱乐，需要至少100Mbit/S的数据速率。</span> 为了应对这些新出现的需求，业界开始采用交换式以太网作为车载通信主干[4]。虽然以太网满足了未来的汽车通信需求，但可靠性和实时性能方面的几个挑战仍未部分解决-后者是本文的主题。
图1显示了具有交换以太网主干的汽车架构示例。图的左侧是环形拓扑中的ADAS平台的典型示例。以太网交换机集成在电子控制单元(ECU)中，以及一个相机和一个雷达中。图的右侧表示通过CAN或CAN-FD网络进行通信的传统汽车域。 这些域中的每一个都通过ECU连接到以太网主干，以与域中的传感器和执行器建立通信。
![image.png](https://gcore.jsdelivr.net/gh/wsm6636/pic/202310182233498.png)
图1.具有以太网主干、集成在ECU和传感器中的交换机以及基于CAN和<span style="color:black;background:#d59e83 !important;">CAN-FD</span>的域网络的汽车电子架构示例。==点对点交换==以太网络用于传感器和ECU之间的数据通信(<span style="color:black;background:#d59e83 !important;">UC表示集成在ECU或传感器中的微控制器</span>)。图中显示了多播流，其中摄像机是发送方，ECU1和ECU2是接收方。
> CAN-FD CAN总线plus

<span style="color:black;background:#d59e83 !important;">以太网AVB[5]是一个标准(IEEE 802.1BA)，它定义了实时通信通常需要的几个功能：这些功能包括时间同步、流量整形和带宽预留[6]。</span>目前，IEEE 802.1 TSN(时间敏感网络)任务组[7]正致力于定义和标准化用于基于交换式以太网系统的实时通信的下一代特征，例如具有用于超低延迟的分组抢占的调度时间触发流量、用于容忍单一故障的无缝冗余(例如，在环形拓扑中)以及用于保护网络免受错误或恶意流量影响的入口管制。尽管这些机制是重要的构建块，但仍然需要能够为混合流量模式提供实时保证和高链路利用率的流量类别和调度器。正如我们在第二节中详细说明的那样，由于时间同步和调度通信的性质或由于实时性能的限制，硬实时应用中的大多数以太网技术仅限于周期性流量。

**贡献**：本文解决了在混合业务量模式下的交换式以太网中实现实时性能的挑战，扩展了实时以太网中的现有方法。我们提出了一种新的异步流量类别，称为<span style="color:black;background:#ff4d4f !important;">基于紧急程度的调度器(UBS)</span>，它具有以下关键属性和优势：(A)在高链路利用率时低且可预测的最坏延迟；(B)低实现复杂度；(C)时间可组合性；以及(D)与全局时间可用性无关。我们提出了一种形式化的时序分析，该时序分析在以下意义上是时间可合成的：首先，分别分析网络中每台交换机的实时数据流(即每跳延迟计算)。其次，端到端延迟是根据网络拓扑和每跳延迟的闭合形式组合计算的。实验结果证明了瑞银和这一分析的意义。

本文的其余部分组织如下。第二节介绍了网络模型、流量调度的相关工作和流量模型。核心贡献载于第三节(基于紧急情况的调度器概念)和第四节(正式时间分析)。第五节给出了实验结果，验证了所提出的调度方法和相关的时序分析。第六部分为结束语。

## 2.PRELIMINARIES
### 2.1网络模型
我们考虑由通过物理点对点全双工链路连接的节点组成的网络。<span style="background:#d59e83">节点可以是终端站（通过一个端口连接到一条链路），也可以是交换机（通过多个端口连接到多条链路）。</span><span style="background:#d59e83">流是沿着固定路径从一个特定源终端站发送到一个（单播）或多个（多播）终端站的一系列数据包。</span>在应用上下文中，终端站可以是流的发送者（称为发送者），也可以是流的接收者（称为侦听者）。

终端站的示例是图 1 中最左侧描绘的雷达设备和集成在 ECU1 中的微控制器。图中显示了六个以太网交换机，全部集成在 ECU 或传感器中。流的一个示例是由图 1 左下角的摄像头（讲话者）生成的视频数据。通信路径在设计时根据给定的网络拓扑进行固定：在我们的示例中，视频流通过集成在其他摄像头传感器中的开关以及 ECU1 和 ECU2 中的集成开关到达其监听器（ECU1 和 ECU2 中的微控制器） 。该示例中所示的特定流是多播流。

### 2.2流量调度相关工作
传统上，AVB 以太网使用基于类的服务模型。多个流（每个流具有保留的数据速率）被收集在最多两个 FIFO 队列（A 类和 B 类）中。在数据包传输之前，队列由基于信用的整形器 (CBS) 整形 [8]。 CBS 随着时间的推移将数据包分散在队列中，以便不超过保留速率的总和。虽然实现起来很简单，但使用 CBS 的网络分析起来很复杂 [9][10][11]。在高链路利用率下，CBS 被证明可以提供较差的延迟保证 [12]。
循环排队和转发 (CQF) 是在 IEEE 802.1 TSN 任务组 [13] 中提出的，目前正在标准化为 802.1Qch [14]。CQF 是一种基于同步帧的调度方法，类似于走走停停的排队[15]。传输由网络范围内的可配置时间框架强制执行。与 CBS 不同，CQF 依赖于全局同步时间概念的可用性。<span style="color:black;background:#d59e83 !important;">即如果时间同步失败，则CQF失败。</span>
这同样适用于严格的时间触发调度方法，称为时间感知整形器 (TAS)，标准化为 802.1Qbv [16]，它依赖于一组可配置的时隙，在这些时隙中允许特定队列传输数据包。这种 TDM（时分复用）解决方案也出现在 TTEthernet [17] 中并在 [18] 中提出，被广泛认为可以提供尽可能低的延迟。低延迟带来了在固定和网络范围内统一的周期内强制进行数据包传输的成本，这通常会导致网络带宽的利用效率低下[19]。<span style="color:black;background:#fff88f !important;"> CQF 和 TDM 都不适合混合事件驱动、周期性和速率受限的实时流量，例如 ADAS 应用或汽车骨干网络中的流量。例如，雷达和激光雷达是此类系统中使用的典型传感器，它们具有不同的数据包长度和数据速率，具体取决于驾驶环境和交通状况。</span>

航空电子全双工交换以太网 (AFDX) 是一种在交换机中使用 FIFO 调度策略的异步实时解决方案。整形仅在终端站中执行。在[20][21]中也可以找到一般方法，它允许高带宽利用率。然而，AFDX 中的高带宽利用率需要谐波周期性流量模式1，这也在最近的时序分析框架中得到了利用[22]。

我们的建议<span style="color:black;background:#d59e83 !important;">基于速率控制服务规则（RCSD）</span>，如 RCSP [23] 和 RC-EDF [24]，它们是在集成服务 [26] 背景下针对实时流量传输协议 [25] 提出的。与流行的通用处理器共享 (GPS) 近似（如 PGPS/加权公平队列 [27]）不同，<span style="color:black;background:#d59e83 !important;">RCSD 将分配的带宽与延迟分离</span>。RCSD 是非工作保存的，并且在数据包被调度传输之前根据底层流量模型重新调整单独队列中的每个流。这可以防止每个流淹没调度程序，从而（a）限制每个交换机的积压（b）隔离流并防止恶意过载导致调度程序拥塞，以及（c）降低不同流之间的干扰水平。结果表明，即使在高链路利用率的情况下，所有服务器中的这种重新整形也提供了合理的低延迟保证\[25]\[24]\[28]。

RCSD 的概念存在多个可扩展性问题。每个流的重塑需要每个流状态。<span style="color:black;background:#d59e83 !important;">整形队列之间的仲裁需要根据队列的资格时间进行动态重新排序，这定义了流的下一个数据包何时可以进入调度程序</span>[29]。<span style="color:black;background:#fff88f !important;">在调度器(RC-EDF或FlexTDMA++[30])中可能需要额外的重新排序(例如，通过最后期限)。重新排序需要像堆这样的优先级队列实现，这引入了非常量的复杂性[31]</span>。专门的日历队列[32]是在[25][33]中作为恒定复杂性解决方案提出的。这些要么 (a) 需要过多的内存，(b) 不精确，要么 (c) 仅适用于有限的配置。 [34][35][36]中提出的专用硬件架构通过加速非恒定复杂性算法以更多并行逻辑为代价来提供权衡，但通常不能克服与每个流整形相关的复杂性问题。

我们的提案代表了一种更具可扩展性和更高效的重塑和调度方法。我们展示了其硬实时功能，可在时间敏感的交换以太网中以高链路利用率实现实时通信。

![image.png](https://gcore.jsdelivr.net/gh/wsm6636/pic/202310241558833.png)
### 2.2流量模型
在本文的其余部分中，我们考虑异步发出流的说话者应用程序，每个流满足漏桶约束\[37][27]。后者通过<span style="color:black;background:#d3f8b6 !important;">突发度</span>$\hat{b_i}$ 和<span style="color:black;background:#d3f8b6 !important;">泄漏率</span>$\hat{r_i}$来表征每个流$f_i$。对于<span style="color:black;background:#d3f8b6 !important;">持续时间d的任意时间间隔</span>，漏桶约束将流$f_i$的<span style="color:black;background:#d3f8b6 !important;">累积分组数据</span>$w_i(d)$ 限制为
![image.png](https://gcore.jsdelivr.net/gh/wsm6636/pic/202310242048012.png)
在混合流量模型的上下文中，此约束可以被视为涵盖更具体流量模型的“元模型”。因此，它消除了特定的业务特征，具有避免不同流之间的相互依赖的有益特性。满足相同漏桶约束的三种流量模式如图2所示。例如，具有固定周期ti和固定分组大小li的周期性流fi将被映射为$\hat{r_i}=l_i/T_i$ ti和$\hat{b_i}=l_i$。流量模式将类似于图2中的模式A。转换为零，允许在不同的周期流之间进行任意周期。作为另一示例，具有可变分组长度的音频/视频流(例如，说话者[8]中的每个流用CBS整形的AVB流)将类似于模式B。该模型允许连续数据包发射/突发，如模式 C 所示（例如，如果大数据单元被分段或数据包被复制，每个数据包包含相同的关键事件以容忍单个数据包丢失）。
> 流量模式A
> AVB：B
> 连续数据包发射/突发？C

## 基于紧急程度的调度程序UBS

我们的建议提供了与 RCSD 类似的性能，而无需与交换机中的每个流整形相关的大量实施工作。基本的基本思想是每个流队列和每个流状态之间的概念分离。两者被视为两个不同的数量，对实施工作具有不同的影响：每个流状态已经存在，即使在端口数较少的交换机中也是如此。例如，当前正在标准化为802.1Qci的每个流的入口策略等新功能依赖于每个流的状态变量[38]2。TAS依赖于存储在交换机中的时隙配置，并且可能需要更多的时隙来实现最佳调度[39]。相比之下，每流队列仅在高级设备(如支持集成服务的设备)中找到。与TAS、CQF或CBS相比，即使每个流条目具有几百个容量的优先级队列的实现工作也要高得多。

每流队列和状态的概念分离允许我们在每一跳为(FIFO)队列中的流聚合提供每流整形。这一新颖的概念被称为<span style="color:black;background:#d59e83 !important;">交错成形</span>。它<span style="color:black;background:#ff4d4f !important;">限制了设备特定数量上所需的队列，而与流的数量无关</span>，因此显著降低了每跳整形的算法复杂性(第III-B节)。

本节的其余部分描述所使用的排队模型(第III-A节)、将流聚合到队列的队列分配方案(第III-B节)和整形算法的操作(第III-C节)。

### 3.1队列模型
UBS使用严格的优先级调度，就像在以太网中已经发现的那样[8]。这将导致以下两级排队模型：
(1)调度器外部的整形队列的阵列，每个队列与固定优先级和单独的整形器相关联，以及
(2)调度器中的每个优先级一个队列。后一队列中的每一个合并相同优先级的所有整形队列的输出。
<span style="color:black;background:#d3f8b6 !important;">所有队列都实施FIFO策略；不使用优先级队列</span>。在队列分配方案的上下文中，在图3和图4中说明了排队模型。<span style="color:black;background:#d3f8b6 !important;">我们将调度器外部的整形队列简单地表示为队列，将调度器中的队列表示为伪队列。</span>

术语伪队列基于实现假设：如果像我们的建议中那样只需要几个(整形)队列，则直接从(整形)队列传输的高效调度器实现是可能的。<span style="color:black;background:#ff4d4f !important;">通过比较(A)相关联的优先级和(B)队列头(HQ)分组的合格时间来识别要传输的下一个分组。</span>这可以例如通过比较器网络或在前一分组当前正在传输的同时对所有队列/HQ分组进行线性迭代来实现。在这两个示例中，伪队列都不会在物理上实现。
![image.png](https://gcore.jsdelivr.net/gh/wsm6636/pic/202310251640126.png)

![image.png](https://gcore.jsdelivr.net/gh/wsm6636/pic/202310251640200.png)

### 3.2队列分配方案
我们假设在每个服务器上分别将所有流分配到固定的优先级。一个流可以属于不同服务器上的不同级别。这允许像AVB这样的网络范围的业务类别，其中流在每一跳属于相同的优先级。同样，它允许高度优化的配置在系统特定的约束下满足具有挑战性的延迟要求。虽然配置的综合超出了本文的范围，但下面的队列分配方案是通用的，适用于这两种方法。
> 流在不同server上可以不同优先级，但是AVB可以相同

考虑一个服务器$S^h$ 从服务器$\{S^{h-1}_1,...,S^{h-1}_{n-1}\}$接收一组流F。换句话说，$S^h$位于n端口交换机中的出口端口处，并且$\{S^{h-1}_1,...,S^{h-1}_{n-1}\}$连接到同一交换机中$S^h$的相反端口。对于任意两个流fi,fj
∈F，我们定义了以下三个队列分配规则：
QAR1：如果FI和FJ都是从$\{S^{h-1}_1,...,S^{h-1}_{n-1}\}$中的不同服务器接收到的，则不允许FI和FJ共享一个队列
QAR2：如果Fi和Fj都是由不同优先级的同一服务器$S^{h−1}_k$(1≤k<n),则不允许FI和FJ共享一个队列
QAR3：如果$S^h$以不同的优先级发送fi和fj，则不允许它们共享队列

这些规则与第四节中的时序分析相关，但我们在这里给出直观的解释。与RCSD中一样，QAR1维护来自不同节点的流量之间的隔离。这防止了来自故障服务器S h−1 k的恶意过载传播到第一个连续服务器Sh之外。Qar2和Qar3保证来自任何服务器Sh−1 k的分组可以由服务器Sh中的调度器以先进先出的顺序处理。回想一下，所有队列都有关联的固定优先级。QAR2确保较高优先级的分组可以绕过由服务器Sh−1 k发送的较低优先级的分组。同样，QAR3允许Sh用于较高优先级传输的分组绕过用于较低优先级传输的分组。这两个规则结合在一起避免了对队列前瞻操作的任何要求。

对于每台服务器，我们区分了强制队列和可选队列，前者是在单个优先级上重塑所需的，后者可用于支持不同的优先级。交换机必须实现强制队列，而提供可选队列是一种实现决策，有了强制队列，交换机就可以始终参与网络通信，而不依赖于流的数量和各自的路径。由于没有多个优先级，因此只需考虑QAR1。在n端口交换机中，QAR1将服务器Sh中的强制队列数量限制为n−1，每个队列由来自相反入口端口之一的所有流共享(图3)。因此，强制队列的数量是特定于设备的常量，该常量随端口数而变化。

在特定网络中，根据QAR2和QAR3(图4)，未使用的入口到出口组合的空闲强制队列和可选队列(如果实现)可用于多个优先级。如果服务器Sh和Sh−1 k以P h和P h−1 k优先级发送，则Sh中的P h−1 k P h队列将允许所有组合。相邻服务器之间所需的优先级和组合数量取决于延迟要求。通常，仅整形就能提供低延迟界限。如后面所示，处于相同优先级的数据流经历了大致相同的延迟。不同的优先级在特定跳跃时扩展延迟频谱。这允许在单个优先级设置尚未满足延迟要求的情况下满足延迟要求。

### 3.3 交错整形算法
交织整形器严格按照FIFO顺序从相关队列输出分组。我们重新实现了两种常见的PER流算法作为交错整形算法，并在第四节-C节的末尾简要讨论了其他算法。每流的两个算法是(A)用于可变分组长度的逐个分组的漏桶算法[23][40]和(B)基于令牌的漏桶算法[41]。相应的交织整形算法被表示为(A)长率商(LRQ)和(B)令牌桶仿真(TBE)。清单1和清单2显示了这两个队列的操作，其中描述了单个队列QI

这两种算法都使用存储在数组状态中的显式每流状态，该状态在当前HQ分组P输出到伪队列之后被更新。流Fi的每流状态包含时间戳ti，并且在TBE的情况下，包含桶级别bi。包长度L和流索引I是到达服务器的包的一部分。这两个变量都是元数据，并未明确包含在传输中的分组中。集合I包含具有I∈I的QI中的流的所有(唯一)索引。Time Tnow是设备的当前本地时间，与任何网络范围的全球时间无关。LRQ和TBE使用的变量如下：

LRQ：时间戳ti存储流fi的下一个分组的合格时间。在p的输出时间，时间戳ti等于商(L/rˆi)。在p之后的流fi的下一个分组至少被延迟，直到tnow到达ti。这强制了漏桶约束，其中将Fi的a(先验已知)最大分组长度Lˆi用作突发(bˆi=Lˆi)。对于固定和可变的分组长度，LRQ的输出模式将分别受到类似于图2中的A和B的约束。

Tbe：时间戳ti存储分组p的输出时间。同时更新存储桶级别bi。变量bi可以解释为bˆi的“剩余突发性”。如果当前HQ包p的长度为L的fi将超过bi，则包p被延迟，直到桶级别bi恢复到L时它变得合格。tbe的输出模式将受到类似于图2中的C的约束。tbe允许包突发，这使得它适用于更广泛的更具体的流量模型。LRQ将随着时间的推移传播数据包。

由针对当前HQ分组的每个流的区分给出的交织操作在两种算法中引入了不同流之间的交叉依赖关系：流Fi的不合格分组可以在Fj的分组成为HQ分组之前延迟另一流Fj的已经合格的分组。我们在第四节中表明，这些额外的延迟是零或相当小的，最重要的是，不会随着时间的推移而累积(可能是无限的)。

必须基于分组数据中的地址信息为每个接收的分组识别流索引i。这意味着在分组到达服务器之前进行查找操作。从实现的角度来看，这可以在不引入新的非常复杂操作的情况下完成：i的查找可以与转发和每个流策略[42][8][38]所需的操作相结合。与此类似，rˆi和bˆi可以被查找并附加到分组，而不是将两者存储在状态数组中，因为两者都被算法视为常量(在算法中没有明确示出rˆi和bˆi的位置)。

## 4.形式时序分析
我们基于来自第三节-B节的模型，孤立地分析用于单跳的时序，假设(A)存储和转发操作，(B)在发送方和接收方具有相等参数的固定流配置，(C)非过度供应的链路，(D)非抢占式分组传输，以及(E)没有超出TBE和LRQ算法约束的附加业务模式约束(如与延迟要求的关系或关于分组到达间隔时间的假设)。只分析显著的延迟，即由队列、伪队列以及存储和转发操作造成的延迟。附加的器件特定延迟、线路延迟和振荡器偏差被忽略。









***

# 笔记

## 1 论文创新在于

## 2 解决了什么问题

## 3 方法

## 4 不足&可继续研究

## 5 可参考

## 6 思考

***

标签 

链接
[ATS](ATS.md)

Referred in <a href="zotero://note/u/V5BHLJX8/?ignore=1&#x26;line=-1" rel="noopener noreferrer nofollow" zhref="zotero://note/u/V5BHLJX8/?ignore=1&#x26;line=-1" ztype="znotelink" class="internal-link">ATS</a>
