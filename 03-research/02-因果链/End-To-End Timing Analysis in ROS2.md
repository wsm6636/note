---
created: 2023-07-21T13:43
updated: 2024-03-26T23:33
tags:
  - 笔记
  - 笔记/文献笔记
---

# End-To-End Timing Analysis in ROS2

| Title                 | End-To-End Timing Analysis in ROS2                                            |
| --------------------- | ----------------------------------------------------------------------------- |
| Journal or Conference | 2022 IEEE Real-Time Systems Symposium (RTSS)                                  |
| Authors               | Harun Teper; Mario Gunzel; Niklas Ueter; Georg Von Der Bruggen; Jian-Jia Chen |
| Pub. date             | 12/2022                                                                       |
| DOI                   | [10/gsfbv3](https://doi.org/10/gsfbv3)                                        |
| Level                 |                                                                               |

# End-To-End Timing Analysis in ROS2

# ROS2中的端到端时序分析

## 摘要

ROS2中的端到端时序分析ROS2中的端到端时序分析现代自主车辆平台具有许多相互作用的部件和传感器，这增加了系统的复杂性，影响了它们的性能。这类平台的一个关键方面是端到端的定时保证，这是在任何情况下都需要安全和可预测的行为所必需的。

开发这种自主系统的一个广泛使用的工具是Robot操作系统2(ROS2)，它允许创建由几个相互通信的组件组成的机器人应用程序，以形成复杂的系统。此外，它使用管理所有组件执行的定制调度器设计来保证实时约束并提供可靠的计时行为。这些组件及其数据传播形成可以分析的多个因果链，以确定两个关键指标：最大反应时间(这是系统对外部输入做出反应的最长时间)和最大数据寿命(等于采样和基于该样本的系统输出之间的最长时间)。然而，ROS2系统中的因果链的端到端分析还没有提供。

本文给出了单电子控制单元(ECU)上ROS2系统端到端定时的理论上界。此外，我们还展示了如何模拟ROS2系统以获得时序分析的下界，并介绍了一种针对现有ROS2系统的在线端到端时序测量方法。我们用一个基本的自主导航系统对我们的方法进行了评估，并确定了不同组件和传感器配置的定时行为。

## 1介绍

现代自动驾驶汽车包括越来越多的部件，这些部件必须遵守时间限制，以确保车辆及其环境的正确功能和安全。它们包括不同电子控制单元(ECU)上的智能灯、ACC和ABS等组件，这些组件通过车内网络进行交互。此外，还有许多以不同硬件和软件解决方案为特色的系统设计。随着这些系统的复杂性增加，保证时间约束变得更加困难。

用于开发自主系统的一个广泛使用的软件框架是Robot操作系统2(ROS2)[13]，它是一组用于开发机器人软件的软件库和工具。ROS2允许自由创建任意复杂的机器人系统，因为它提供了工具来创建可以相互通信的简单组件。它还提供了一个可定制的调度程序抽象，称为执行程序，用于处理每个系统组件的时间触发和事件触发功能。自动驾驶项目Auoware.Auto[11]，[19]代表了一种基于ROS2的先进开源解决方案，具有自动代客停车和货物递送功能。

ROS2的一个承诺是提供实时保证的可能性，这在最初的机器人操作系统(ROS)[15]中没有考虑到。最近对ROS2执行器进行了分析和优化[2]-[5]，[18]。具体地说，ROS2组件的执行可以建模为有向无环图(DAG)，其最坏情况的响应时间可以通过扩展实时系统中的现有时序分析方法来推导[2]、[4]。此外，Choi et al.[5]提出了一种针对ROS2执行器的优先级分配方法，以提高最坏情况下的响应时间。Tang等人没有将**ROS2组件建模为DAG。[18]提出将它们建模为处理链**，以执行最坏情况响应时间分析和优化组件优先级。

如果所有组件都主动触发它们所连接的组件，则ROS2组件之间的通信可以用DAG[2]、[4]、[5]的最坏情况响应时间来描述。然而，ROS2还具有数据传播和执行顺序独立于其他任务的组件。例如，任务链可以包括根据它们的周期零星执行的多个中间定时器，或者包括其任务也由其他链的任务触发的链。事实上，这样的链条可以更恰当地建模为因果链。

因果链模拟了从原因(例如，感知)到结果(例如，激励)的一系列反应。**ROS 2系统的因果链的定义灵感来自AUTOSAR时间扩展的事件链**[1]，以及G̈unzel等人对因果链的定义。[10]适用于周期性和零星任务系统。文献中最感兴趣的是两种类型的端到端延迟：最大反应时间(这是系统处理外部事件的最长时间)和最大数据年龄(这是采样和基于该样本的输出之间的最长持续时间)。

然而，**仅适用于周期性和零星任务系统，不能直接应用于ROS2的事件触发和时间触发组件。**

**贡献：**据我们所知，我们提供了第一个ROS2因果链的端到端时序分析。我们假设我们的系统有一个ECU，其组件由一个单线程ROS2执行器调度。第二节详细介绍了ROS2的体系结构，第三节介绍了ROS2的任务模型、因果链和定时值分析。第四节和第五节分别介绍了相关的工作以及对ROS2的划分和讨论。

## 2、ROS2系统模型

ROS2是一组用于构建机器人系统和应用程序的软件库。在这一节中，我们解释了它的体系结构，包括第II-A节中的主要组件和互连，以及第II-B节中的ROS2调度器(称为ROS2执行器)，如前面的工作[2]、[4]所述。第II-C节说明如何根据第II-A节中详细说明的组件组成机器人系统。

主要组件和互联

我们考虑一个ROS2系统，由两种类型的组件组成，节点和主题。

·节点代表接收、处理和转发数据的系统的一个组件。它由计时器和订阅以及由它们执行的函数组成。每个定时器和订阅被分配给节点的一个特定函数，这些函数称为回调函数或回调。

-定时器定义时间触发的回调，该回调访问节点中的数据或从外部接口接收数据，以处理消息并将消息发布到订阅或通过外部接口发布到底层机器人平台。

-订阅定义处理接收消息的事件触发回调。它们可以将结果存储在节点中，或者通过外部接口将结果发布到其他节点的订阅或发布到底层机器人平台。

我们注意到，一个节点还可以由其他服务组成，这些服务与我们的研究无关。

·主题被用作不同节点之间的交流手段。它是通过数据分发服务(DDS)实现的，DDS为消息传输提供了发布-订阅体系结构。在ROS2中，节点可以向主题发布消息，以便订阅该主题的所有节点都能收到消息

B.ROS2执行器调度

在本文中，我们考虑了系统在一个ECU上的执行，它具有一个单线程ROS2执行器，它调度系统节点的所有定时器和订阅回调。

ROS2执行器实现了一个定制调度策略。它存储所有已注册节点的所有计时器和订阅，并在计划期间更新它们的状态。与经典的实时调度理论相关联，回调函数可以被视为一个循环任务，并且回调函数的每次执行都是一个任务实例(或作业)。作业可以处于以下状态之一：空闲、激活、已采样和正在运行。每个任务可以有几个空闲作业，这些作业先被启动，然后被外部事件激活。对于计时器，每过一段时间就激活一个作业，而在收到新消息时激活订阅。每个计时器和订阅都有一个具有最大缓冲区大小的缓冲区，用于存储任务的当前激活作业。我们注意到，订阅的作业以FIFO顺序处理其缓冲区中的消息。如果缓冲区大小不足，可能会发生采样不足或消息丢失。我们假设缓冲区足够大，以在所有情况下避免欠采样或消息丢失。

执行器的调度机制被设计为使用由轮询点和处理窗口组成的两阶段设计来采样和执行作业(参见图1)：

·在每个轮询点，执行器采样每个任务中最早激活的作业，该作业将在下一个处理窗口中执行。

·在每个处理窗口中，采样的作业按照执行者的调度策略指定的顺序执行。我们假设每个计时器和每个订阅都有唯一的优先级。在ROS2-Foxy(当前支持的ROS2版本)中，定时器的优先级高于订阅，定时器和订阅的优先级分别遵循注册顺序。

在执行完所有采样回调后，Executor运行下一个轮询点。如果在轮询点处没有激活的作业，则Executor会旋转，直到发生外部事件，例如计时器周期已过或收到消息。

C.系统组成

在这一小节中，我们根据定时器和订阅以及它们的通信方式来区分几个节点类。此外，我们还介绍了如何通过计时器和订阅在节点内和节点之间传播数据。ROS2系统包含包含定时器和订阅及其相应回调的节点。具体地说，我们考虑了六类节点，即传感器、过滤器、订阅执行器、定时器执行器、订阅融合和定时器融合。它们根据触发的方式(例如，计时器、回调或它们的混合)以及是否发布到主题进行分类。表一显示了这一分类。

***

# 笔记

## 1 论文创新在于

## 2 解决了什么问题

## 3 方法

## 4 不足&可继续研究

## 5 可参考

## 6 思考

Referred in <a href="zotero://note/u/HWG3PU5P/?ignore=1&#x26;line=-1" rel="noopener noreferrer nofollow" zhref="zotero://note/u/HWG3PU5P/?ignore=1&#x26;line=-1" ztype="znotelink" class="internal-link">cause-effect chain</a>



