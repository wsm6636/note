---
created: 2023-07-21T12:27
updated: 2024-03-26T23:33
tags:
  - 笔记
  - 笔记/文献笔记
---

# Hybrid Scheduling of Tasks and Messages for TSN-Based Avionics Systems

| Title                 | Hybrid Scheduling of Tasks and Messages for TSN-Based Avionics Systems |
| --------------------- | ---------------------------------------------------------------------- |
| Journal or Conference | IEEE Transactions on Industrial Informatics                            |
| Authors               | Xuan Zhou; Feng He; Luxi Zhao; Ershuai Li                              |
| Pub. date             | 2023                                                                   |
| DOI                   | [10/gsfbv9](https://doi.org/10/gsfbv9)                                 |
| Level                 |                                                                        |



# Hybrid Scheduling of Tasks and Messages for TSN-Based Avionics Systems——基于TSN的航电系统任务和消息混合调度

IEEE TRANSACTIONS ON INDUSTRIAL INFORMATICS   **TII**

**CCF C**

**JCR Q1**

## introduction

综合航电系统是一个功能复杂的信息密集型系统，已经发展了三十多年。考虑到飞机硬件资源和软件应用的实际部署，服务于相同功能的多个任务可能驻留在不同的模块中，通过消息交换信息。以飞机自动驾驶功能为例，机头的数据融合任务将检测到的大气、姿态等数据进行融合，然后将数据报文发送到机柜的计算任务。在计算出舵面位置等参数后，计算任务将控制信息发送到机翼上的动作执行任务以调整飞行。也就是说，分布在飞机上的任务形成了一条由消息链接的链，以实现所需的功能[1]。

面对航空电子系统日益增长的功能需求，时敏网络以其高确定性、高带宽、低时延等特点被认为是机载组网的一种选择。相应的标准已经在起草阶段[2]。在基于TSN的航空电子系统中，网络调度可以保证基于时间感知整形(TAS)的调度业务(ST)消息的及时传输[3]，这也是大多数相关工作的重点[4]-[6]。然而，这些网络调度研究很少考虑消息传输与任务执行的协调，因此可能会导致以下情况。1)ST消息从任务中产生后，刚好错过了分配给源端系统的ST队列的打开窗口，所以必须等到ST队列的定时门再次打开。2)一条ST消息到达其目的地ES，但该ES正在执行另一个任务，因此该消息必须等待其消费者任务运行。这些不匹配会延长任务链的完成时间，甚至阻碍航空电子功能的有效实现。

## **背景：**

航空电子。

以飞机自动驾驶功能为例，机头的数据融合任务将检测到的大气、姿态等数据进行融合，然后将数据报文发送到机柜的计算任务。在计算出舵面位置等参数后，计算任务将控制信息发送到机翼上的动作执行任务以调整飞行。也就是说，分布在飞机上的任务形成了一条由消息链接的链，以实现所需的功能[1]。

在基于TSN的航空电子系统中，网络调度可以保证**基于时间感知整形(TAS)的调度业务(ST)**消息的及时传输[3]，这也是大多数相关工作的重点[4]-[6]。

> QBV

然而，这些**网络调度研究很少考虑消息传输与任务执行的协调**，因此可能会导致以下情况。

1)ST消息从任务中产生后，刚好错过了分配给源端系统的ST队列的打开窗口，所以必须等到ST队列的定时门再次打开。

2)一条ST消息到达终端ES，但该ES正在执行另一个任务，因此该消息必须等待其消费者任务运行。

这些不匹配会延长任务链的完成时间，甚至阻碍航空电子功能的有效实现。

为了避免这些不匹配，可以通过引入时间触发(TT)任务来进行任务和消息的混合调度，这有利于系统级决定论[7]。

==**然而，由于TTE和TSN的调度机制不同，这些研究不能直接应用于基于TSN的航空电子系统。**==

**TTE为每个TT消息指定时隙，其节点可以在存储该消息时从缓冲器中挑选要调度的TT消息。TSN将时间窗口分配给遵循先进先出(FIFO)原则的ST队列，并且ST消息必须排队才能在网络中注入或转发[10]。**

==然而，如果消息注入顺序与ES中的任务执行顺序不一致，则一些ST消息可能会受到FIFO队列的影响，无法在合成时间窗口内如期在网络中传输。==

> 要解决的问题

## **动机**：

因此，**如何克服时序不一致的问题**，保证系统级的确定性，成为基于TSN的航空电子系统混合调度的首要问题。此外，为了有效地保证基于TSN的航空电子系统的功能，混合调度还需要处理以下两个问题。

一个问题是如何减少混合调度方案的**==功能延迟==**，以确保航空电子功能的高效实现。

> 反应时间，数据年龄	

然而，==大多数相关的延迟研究都是基于任务链的优先级调度，而不是TT调度[11]，因此它们不能在这里应用。==**虽然TT任务和ST消息由于其确定性而便于延迟计算，但它们复杂的周期关系增加了识别有效执行的难度。**

> 为什么不能用

另一个问题是如何快速找到由海量任务和消息组成的复杂航电功能的**==混合调度解==**。

然而，这些研究不能支持这里的混合调度，因为它们不能处理TT任务。虽然先对任务再对消息进行增量调度可以得到可行的混合调度方案，但仍然需要一种新的消息排序策略来响应冻结的任务方案和新的一致定时。

## **贡献**：

为基于TSN的航空电子系统构建了一种新的面向功能的混合调度框架。它嵌入了系统一致性约束来协调任务和消息的定时，保证了混合调度的系统级确定性。

提出了一种基于TSN的航空电子系统功能时延的计算方法。该算法能够**处理TT任务和ST消息之间的复杂周期关系，准确地得到航电功能的反应和时延**，相应的时延计算公式可以作为混合调度的优化目标。

针对基于TSN的航空电子系统设计了两种增量式混合调度算法，包括基于==消息动态排序策略==的ASAP算法和基于==任务-消息重调度策略的功能延迟优化==算法。它们可以实现对海量任务和消息的高效调度，增强系统功能的实时性。

> 关键任务TT与ST消息，如何安排，保证终端设备任务执行顺序一致

## **目标**

## **任务模型**

![image-20230325220905425](https://gcore.jsdelivr.net/gh/wsm6636/pic/202307211401277.png)

基于TSN的航空电子系统包括三种类型的组件：承载处理资源、运行任务和产生/消费消息的模块(即**网络中的ES**)；实现消息路由和转发的**交换机**；以及连接节点以提供消息传输通道的**物理链路**。

节点的每个输出端口都有八个优先级队列来存储等待传输的消息，其中最高的一个专门用于ST消息，其他的用于音视频桥接(AVB)或尽力而为(BE)消息。

> TSN QBV就是这样？

每个队列都有一个关联的定时门，以根据门控制列表(GCL)启用或禁用消息传输。一个简单的基于TSN的航空电子系统如图1所示。

![image-20230325220851581](https://gcore.jsdelivr.net/gh/wsm6636/pic/202307211401513.png)



系统函数fh是跨越多个ES的任务链⟨τi⟩，其中τi是具有执行周期τP i和运行时间长度τL i的属性的任务。

在综合航电系统中，任务τi可能具有多种功能，因此它可能具有多个处理机任务或后续任务。任务通过消息进行通信，任务之间的交互关系可以用有向无环图(DAG)来表示。

当▷j具有一个后继任务时，由其生产者任务τ▷j产生的消息mj是单播的，或者当▷j具有驻留在不同ES中的多个后继任务时是多播的。

假设其在▷j的末尾产生并且在其消费者任务的开始处消费，其传输路径pj，i到τi可以由逻辑链路链lk形成。

还假设它与▷j具有相同的周期，即mt j=▷Tτj，并且其长度mL j可以通过将其大小除以链路速率来计算。



**分开的调度约束**

==任务调度是在必要的约束下为ES中的任务执行窗口搜索适当的偏移量==τO i，这些约束已在[8]中系统地表达如下。**任务基本约束**CTB：τO i为非负，并保证对应的执行窗口不超过τP i。**非重叠执行约束**CNE：驻留在同一ES中的任务的执行窗口在时间域上不能重叠。

消息基本约束(CMB)：偏移量应该是非负的，并确保周期内的传输时隙。

无约束传输约束(CCT)：穿过同一链路的消息的传输时隙不应处于竞争状态。

受限转发约束(CBF)：交换机上的消息转发应受限于来自硬件固有参数的最小和最大技术延迟。

同时转发约束(CSF)：在传输路径的分支节点，组播报文应同时转发到所有分支。

**端到端延迟约束(Ced)：报文应在规定期限内完成从源ES到目的ES的传输。**

队列顺序约束(CQO)：消息应该以与已入队的顺序相同的顺序从交换机的ST队列中调度。

## Related work

现有的调度研究主要关注TSN的网络调度问题，其中广泛采用的是约束求解方法[5]、[15]-[17]和智能优化方法[18]-[21]来提高调度性能。然而，它们没有考虑任务和消息的协调，导致系统功能保障不足。一些学者已经注意到**任务对消息调度的影响**[14]，[22]。它们定义了消息的注入时间来描述消息在任务产生后首次注入网络的时间，并提出了流间依赖约束来反映任务执行顺序的影响。然而，这个约束对于实际系统来说太简单了，因为它**假设消息的目的地ES在收到消息时可以立即运行使用者任务，但一个ES总是承担几个任务，这个使用者任务可能必须等到其他正在运行的任务完成。**目前，基于TSN系统的混合调度引起了人们的关注，并通过窃取操作系统的任务调度提出了任务-网络联合调度的思想[23]，但它仍然不能为任务和消息提供可行的调度方案。

实际上，基于TTE系统的混合调度已经取得了进展，例如支持任务调度与消息调度同步的软件实现[24]，以及考虑限制任务执行边界的分区的调度算法[25]。值得注意的是，已经提出了**虚拟链路约束(CVL)**来**限制消息的传输应该在其生产者任务之后并且在其消费者任务[8]、[26]之前**，其可以被表示如下。

其中，Moj，First和Moj，Last(i‘)分别是沿Pj，i’的第一个和最后一个链接上的偏移量。显然，它可以有力地保证任务的顺序执行，但从功能的角度来看，它不能适应基于TSN的系统的混合调度，原因有两个。

首先，**CVL不足以支持FIFO队列**。图2(A)示出了符合CVL和区段II-B中的所有约束的调度解决方案S，其中假设最小技术等待时间为0。具体地说，Mj由τj产生，由τj+4消费。M1沿其路径的==偏移量列表==是[22，28]，而m2、m3和m4的列表分别是[20，23]、[23，32]和[20，25]。将消息输出到L1、L5和L2的端口分别表示为p1、p5和p2。在基于TTE的系统中，消息被存储在缓冲区中，并且可以在它们的偏移量处挑选用于传输，因此S是可行的。在基于TSN的系统中，如果基于时隙长度为1的S合成GCL，则**p1、p5和p2的ST队列的开放窗口分别为T20∼T25、T20∼T27和T23∼T36**。由于m1是在早于m2的p1的ST队列中产生和排队的，所以它首先在L1上传输。同样，在L5上，M3早于M4。然后，交换机按照**m1、m3、m2、m4的顺序转发这些报文，它们的输出时间分别为24、28、33和35**。这里，如图2(B)所示，在p2的ST门按预期关闭之前，m4不能被完全转发。这种情况会损害系统的确定性，因此S对于基于TSN的系统是不可行的。

![image-20230325223445566](https://gcore.jsdelivr.net/gh/wsm6636/pic/202307211401212.png)

> 咋算出来的窗口时间

其次，**CVL不能处理任务链**。将函数fh中的第n个任务表示为τh[n]，其生成的消息表示为mh|n|。综合考虑CVL、CTB和CBF，FH中的所有任务只有在满足下列不等式的情况下才能被调度。

其中|P|是P包含的逻辑链路的数量，而τh[ε]是从Fi中的τh[n]开始具有最小周期的最后一个任务。这大大缩小了任务调度的求解空间，并可能导致某些任务不可调度，特别是在以下情况下：τTh[ε]较小，τLh[n]较长，τh[ε]在任务链中较晚，任务链较长，或者几个任务链中较早的任务密集驻留在几个ES中。图3说明了从均衡器导出的不可调度问题。(2)和(3)基于其中τti=20，mLj=1，并且τL1、τL1和τL1分别为5、8和4的示例。这表明CVL使得很难找到函数的调度解决方案

![image-20230325225945559](https://cdn.jsdelivr.net/gh/wsm6636/pic/202303252259647.png)

> 那什么约束可以处理任务链

![image-20230325230239511](https://cdn.jsdelivr.net/gh/wsm6636/pic/202303252302602.png)

## 混合调度方法

针对基于TSN的航电系统混合调度的上述三个问题，构建了一种新的混合调度框架。它由系统一致性约束、环路功能延迟计算和两种混合调度算法组成，如图4所示

### A.系统一致性限制

基于TSN的航空电子系统的系统级决定论强调任务产生和使用消息时的确定性交互，因为TT任务和ST消息已经使得确定性任务执行和消息传输成为可能。这种确定性交互可以通过系统一致性约束限制任务和消息之间的意外交互来确保，如下所示。

## **不足/可扩展**：

## **实验**：

另一个问题是如何快速找到由海量任务和消息组成的复杂航电功能的混合调度解。



***

# 笔记

## 1 论文创新在于

## 2 解决了什么问题

## 3 方法

## 4 不足&可继续研究

## 5 可参考

## 6 思考

Referred in <a href="zotero://note/u/HWG3PU5P/?ignore=1&#x26;line=-1" rel="noopener noreferrer nofollow" zhref="zotero://note/u/HWG3PU5P/?ignore=1&#x26;line=-1" ztype="znotelink" class="internal-link">cause-effect chain</a>
