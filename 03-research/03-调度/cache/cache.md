---
created: 2023-07-08T20:33
updated: 2024-03-26T23:34
tags:
  - 笔记
  - 笔记/学习笔记
---

# 有关cache的调度

减少缓存干扰对调度的影响，可以通过缓存划分进行隔离，也可以建模缓存行为，在可调度性分析中纳入与缓存相关的延迟。

## 有关缓存划分

### 存在问题

**共享缓存争用**：当在不同内核上同时运行的任务访问映射到同一缓存集的内存时，它们可能会从缓存中逐出彼此的缓存内容，导致**难以预测的缓存未命中**。缓存争用导致的延迟发生的时刻，次数和持续时间都是不确定的。

**传统分析**：预留更多的WCET，但会造成资源浪费，降低了共享缓存提高的系统性能

解决方法之一：**缓存划分**。在不同内核上同时运行的任务总是使用不同的缓存分区。由于在这种方法中并发运行的任务从不访问彼此的缓存分区，因此可以消除由于并发缓存访问而产生的缓存干扰，从而减少总体缓存开销并改善任务的最坏情况响应时间。ARM 的 LbM 技术，Intel 的 CAT 技术。

### 现有方法

1、对缓存和CPU资源静态分配（分区调度）

​		分析简单，**但会造成资源利用率不足**

2、对缓存和CPU资源动态分配（全局调度）

​		能更好利用系统资源（任务可在核间迁移），但需要对任务执行使用的**缓存分区进行锁定**。

​		具有动态任务级缓存分配的缓存感知非抢占式固定优先级调度算法，nFPca。可调度性分析简单；**非抢占性可能导致优先级反转**。

​		具有动态作业级缓存分配的全局抢占调度，gFPca。固定优先级

​		支持缓存划分的可抢占全局 EDF 调度算法，gEDFca。动态优先级

> 实际实现中：Lb M无法控制缓存查找(即缓存命中)发生的位置。因此，即使寄存器被设置，在不同核心上并发运行的任务仍然可能访问彼此的缓存分区。所以需要在任务完成或被抢占时刷新分区。有时有RCU error
>

### 单核

任务内干扰（Intratask interference）：如果任务的内存占用大于分配的缓存空间，或者当该任务的两个内存条目被映射到缓存中的相同空间时，就会发生任务内缓存干扰。这种情况下的结果是任务从缓存中清空了自己的数据或指令。需要注意的是单核处理器也会发生任务内干扰 。

核内干扰（Intracore interference）：核内干扰在单核处理器中也会发生，它还被称为缓存相关的抢占延迟（cache-related preemption delay，CRPD）。核内干扰发生在处理器核内部。具体来说，它发生在抢占任务清空了被抢占任务缓存的数据或指令时。因此，一旦系统重新调度被抢占任务，被抢占任务的数据访问时间就会增加（从而出现延迟）。延迟的严重程度取决于系统采用的缓存替代策略、抢占的时间以及抢占任务的数据访问模式。

> 单核也有缓存划分，但是论文都很久了，九几年的

## 有关缓存的响应时间分析

