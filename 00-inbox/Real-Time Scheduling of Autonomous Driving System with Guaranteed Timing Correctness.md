---
tags:
  - 笔记
  - 笔记/文献笔记
  - 待归档
created: 2024-03-27T18:55
updated: 2024-05-07T12:15
status:
  - ing
---
# Real-Time Scheduling of Autonomous Driving System with Guaranteed Timing Correctness

**TitleTranslation:** 保证时序正确性的自动驾驶系统实时调度
**Journal or Conference:** 2023 IEEE 29th Real-Time and Embedded Technology and Applications Symposium (RTAS)
**Authors:** JinghaoSun, KailuDuan, XishengLi, NanGuan, ZhishanGuo, QingxuDeng, GuozhenTan
**Pub.date:** 2023-05
**DOI:** 10.1109/RTAS58335.2023.00022
**tags:** 
**zoterolink:** [zotero](zotero://select/library/items/ZZ9936VR)

# 摘要

在自动驾驶（AD）系统中，不同激活率的任务之间存在复杂的数据依赖关系，使得分析系统的实时行为变得非常困难。本文将 AD 系统表述为多速率 DAG，并提出了一个集成框架来共同分析多速率 DAG 中各个任务的可调度性和任务链的端到端延迟。整数线性规划 (ILP) 技术的开发是为了指导如何删除冗余工作负载，以增加满足时序要求的机会。本文提出了一种分析框架，该框架实现了以迭代方式创建、分析和完善 AD 系统设计的自动化过程，即上一次迭代的分析结果为下一次迭代中重新设计 AD 系统提供了有价值的指导。进行实验来评估我们的分析方法的性能。


# 一、简介
在自动驾驶（AD）系统中，大量的安全和控制功能由不同供应商开发，并最终由制造商集成到同一目标平台上。这些功能通常以数据相关的周期性任务的形式实现，这些任务以不同的速率激活，并需要在给定的时序约束内相互同步。为了简化自动驾驶系统的开发，汽车工程标准放宽了数据相关任务之间的同步。放松是通过隐式寄存器通信（最后是最好的语义）完成的，其中任务从共享缓冲区空间（例如全局变量）读取最新数据并将其输出独立于其他任务写入缓冲区[1] - [3]。这种语义已经在许多现有系统中得到应用，例如 AUTOSAR [4] 的隐式通信模型和机器人操作系统（ROS）[5] 中的发布者-订阅者模型。

尽管宽松的数据同步机制简化了分布式开发，但它很少考虑现代汽车领域严格的时序要求。 AD系统中主要有两种类型的实时约束，如下所述。

为了适应传统的实时操作系统（RTOS），AD系统的每个任务都被设计有一个期限。 AD系统中所有任务的基本时序要求是在截止日期之前完成执行，在这种情况下，AD任务被称为可调度的。对于保证AD任务的可调度性至关重要，这样AD系统的网络部分才能始终正确工作而不会出现致命错误。

除了传统的截止日期约束之外，许多 AD 应用程序还通过一系列（周期性）任务对数据传播施加新型的端到端延迟约束，这些任务共同协作以实现特定的系统功能，称为任务链或任务链。因果链[6]。由于与物理世界的紧密联系，AD系统对整个任务链中使用的输入数据的“新鲜度”以及任务链的输入数据对该链的输出产生影响的时间高度敏感。

保证AD系统实时约束的一个重要工具，特别是如上所述的网络部分和物理部分，是时序分析，这是本文的主要关注点。

AD系统的时序分析不仅要保证每个单独任务的可调度性，还要限制关键因果链的端到端延迟，这并非小事。现有的调度和时序分析方法要么无法应用，要么效率低下。更具体地说，传统的实时技术是为可调度性分析而开发的，但即使所有任务都在截止日期前完成，它也无法限制端到端延迟。最近的工作提出了几种限制 AD 系统端到端延迟的方法，但所有这些方法都仅限于所有任务都满足其截止日期的强假设 [3]、[7]、[8]。在当前的分析方法下，AD任务的可调度性和端到端延迟约束的可满足性被视为两个独立的问题。因此，AD系统的网络部分和物理部分被迫分开设计和分析。<span style="color:black;background:#fff88f !important;">主要缺点是我们无法共同保证AD系统网络和物理部分的正确性</span>。一旦网络和物理部分之一无法满足其时序要求，AD系统就不安全，应该重新设计。这种设计分析过程将反复重复，直到 AD 系统的网络和物理部分都通过时序分析，这是耗时且乏味的。更不幸的是，（上一次迭代中）的分析结果并没有为下一次迭代中重新设计AD系统提供指导。现有的工作都没有为 AD 系统的迭代设计过程开发有效的方法。<span style="color:black;background:#fff88f !important;">如何共同分析网络部分和物理部分的正确性确实是AD领域的一个具有挑战性的问题。</span>

在本文中，我们重点关注自动驾驶系统网络部分和物理部分时序正确性的共同分析。如果 AD 系统中的所有任务在截止日期前完成执行，则网络部分的计时正确。如果AD系统能及时应对物理世界的紧急情况，即端到端的时延满足时序要求，则物理部分的时序是正确的。我们提出了一个有效的框架来共同保证任务的可调度性和AD系统的端到端延迟约束。我们通过采用复杂的任务模型（称为多速率有向无环图（DAG）[7]）来制定 AD 系统的时序行为，以捕获多个任务的并行激活以及现有系统中应用的隐式通信机制。在多速率 DAG 模型中，每个节点表示定期激活的单个任务。边代表任务之间的数据交换，遵循最后最好的语义并形成任务链。多速率DAG调度最具挑战性的问题是如何妥善处理计算密集型任务释放的繁重工作量与关键链严格的时序要求之间的冲突。可能不需要执行任务的所有激活实体（也称为“作业”）。这是因为某些作业产生的数据不能用于生成最终的控制命令。基于这一观察，我们可以在不违反端到端延迟约束的情况下，删除每个任务中一些不必要的作业，以减少 AD 系统的工作负载。

在时序分析过程中，我们提出了整数线性规划（ILP）模型来配置每个任务的执行模式，以确定应该删除哪些作业。我们开发了一种迭代算法来有效地求解 ILP 模型。最初，我们仅使用基本约束来求解 ILP，以获得粗略的配置。在每次迭代中，我们检查任务集是否可调度，以及端到端延迟在当前配置下是否有很好的界限。如果情况并非如此，则 ILP 模型中会涉及额外的约束，以排除不可行的配置。通过求解放大的ILP模型，我们获得了AD系统的重构。这个过程一直持续到我们成功设计出一个网络部分和物理部分都满足时序要求的自动驾驶系统。我们在不同的设置下进行实验，以将我们的分析方法的性能与最先进的分析方法进行比较。实验结果表明，我们的方法可以显着提高成功设计 AD 系统并保证时序正确性的能力。

本文的其余部分安排如下。我们首先在第 2 节中概述 AD 系统。 II，然后我们在第2节中介绍了多速率DAG的系统模型。三．我们在第 2 节中提出了多速率 DAG 的实时调度框架。四．在秒。 V，我们开发了多速率 DAG 调度的时序分析方法。实验结果在第 2 节中报告。六．相关工作在第 2 节中给出。七．结束语在第 2 节中作出。八．


# 二.AD系统概述
我们专注于数据流复杂、传感器输入多样化的AD系统。 2021 年 RTSS 行业挑战 [2] 中给出了 AD 领域的最新示例。图 1 显示了示例 AD 系统的简化处理图。从左侧开始，AD 系统从毫米波雷达、LiDAR、摄像头和 GNSS/IMU 接收原始传感数据（捕获事件）。传感器以不同的频率独立产生原始数据。 AD系统的数据处理、感知、融合、跟踪、轨迹规划和控制等模块以不同的激活速率激活，使用最新的输入数据进行计算，并定期向下游模块产生输出。下面详细介绍一下。

![image.png](https://gcore.jsdelivr.net/gh/wsm6636/pic/202405071129545.png)
**定期任务**。 AD 系统的每个模块都是作为在特定时期激活的单独任务来实现的。例如，“跟踪”任务以10Hz激活，其周期为100ms。我们将任务分为三类：（1）传感器任务是与传感器对应的任务。例如，在图1中，有四个传感器任务，分别对应毫米波雷达、LiDAR、Camera和GNSS/IMU。当传感器任务被激活时，它能够捕获传感器任务激活时间之前发生的事件。 (2)控制任务是产生控制命令的任务。图1中只有一个控制任务（模块）。 (3)计算任务。其余与传感器或控制模块不对应的任务都称为计算任务。

我们采用ROS2[9]的执行器，它维护一个就绪集来记录准备执行的作业。当一个作业被释放时，只有当同一任务的所有早期作业都完成后，它才能被放入就绪集；否则，该工作就应该被“放弃”。因此，一个任务释放的作业不能重叠或积压[10]，即同一时间点最多有一个作业正在执行或等待执行。为了简单起见，我们为每个作业分配一个明确的截止日期，确保它必须在后面的作业（同一任务）开始执行之前完成。

**数据通讯**。两个任务之间的数据依赖性由有向边表示，如图 1 所示。例如，跟踪任务产生的数据被预测任务消耗。两个任务之间的数据通信利用共享内存中的缓冲区，所有内核都可以访问该缓冲区。更具体地说，每对相邻任务（例如“跟踪”任务和“预测”任务）之间都有一个单位大小的缓冲区。上游（“跟踪”）任务通过输出端口将数据写入缓冲区。下游（“预测”）任务通过输入端口从缓冲区读取数据。缓冲区中的旧数据将被上游任务生成的新数据覆盖。<span style="color:black;background:#d3f8b6 !important;">我们采用AUTOSAR [4]中定义的隐式通信模型，它实现了双缓冲技术来解决相互执行问题。每个任务都遵守逻辑执行时间（LET）</span>，即任务数据的输入在任务激活时执行，输出在任务可用窗口结束时（例如截止日期）执行。抽象地说，LET 范式假设输入/输出操作在零时间内发生。

**计算平台**。 AD系统的任务在同构多核平台上执行。在本文中，我们假设任务被提前分配给核心。例如，我们假设有三个核心。<span style="color:black;background:#d3f8b6 !important;">我们将任务分为三个部分，并将每个部分分配给一个核心。</span>更具体地说，传感器数据（来自毫米波雷达、相机、LiDAR 和 GNSS/IMU）的处理过程在第一个核心上执行。感知（包括“2D感知”、“3D感知”和“感知融合”）和定位部署在第二核上。其他程序（包括“跟踪”、“预测”、“规划”和“控制”）部署在第三个核心上。

**时间限制**。我们的目标是安排 AD 系统以满足以下时序约束。 
  - 一旦作业开始执行，就必须在截止日期之前完成。 
  - 当事件发生时，其相关数据必须在一定的时限内被感知、处理并最终用于生成控制命令。这对应于第 2 节中描述的反应时间约束。 III-B。 
  - 控制命令必须基于足够新鲜的状态信息来执行。这对应于第 2 节中描述的数据年龄限制。 III-B。

第一个约束与AD任务的可调度性密切相关，这对于保证AD系统网络部分的正确性至关重要。第二个和第三个约束是与 AD 系统的物理部分密切相关的端到端延迟约束类型。在下一节中，我们将 AD 系统制定为多速率 DAG 模型，并更正式地阐述这些时序约束。

# 三．系统模型 
## A. 多速率 DAG 模型

我们将 AD 系统建模为多速率 DAG G = (V, E)，其中 V 是节点集，E 是节点之间的边集。 V 的每个节点对应一个周期性任务 τi，具有最坏情况执行时间 (WCET) ei 和周期 Pi。在本文的其余部分中，“节点”和“任务”这两个符号是同义词，我们将毫不混淆地使用这两者。两个任务 τi 和 τj 之间的数据依赖性被建模为 E 的有向边 (τi, τj)。如果没有边进入 τi，则任务 τi 称为 G 的源；如果有，则任务 τi 称为 G 的汇。没有从 τi 发出的边。通常，源对应于传感数据（预处理）处理任务，而接收器对应于控制任务。任务图G允许有多个源和多个汇。

![image.png](https://gcore.jsdelivr.net/gh/wsm6636/pic/202405071215251.png)


例1 图1 AD系统的多速率DAG G模型如图2所示。四个源节点τ1、τ2、τ3和τ4分别对应对来自GNSS/IMU、Lidar的传感数据的处理、摄像头和毫米波雷达。单个汇聚节点τ12对应于控制任务。任务的WCET和周期如上表所示。

**定义 1（任务链）**。 G 的任务链是一个任务序列 π = (τ1, τ2, ···, τh)，使得第 k 个任务 τk 到第 (k +1) 个任务 τk+1 之间存在一条边， ∀k = 1,···,h−1。












***

# 笔记

## 1 论文创新在于

## 2 解决了什么问题

## 3 方法

## 4 不足&可继续研究

## 5 可参考

## 6 思考
