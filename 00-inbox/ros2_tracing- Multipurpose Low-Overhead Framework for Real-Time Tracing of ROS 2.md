---
tags: /ing,schedule,笔记/文献笔记,待归档,笔记
status: done
title: "ros2_tracing: Multipurpose Low-Overhead Framework for Real-Time Tracing of ROS 2"
TitleTranslation: ros2_tracing：用于 ROS 2 实时跟踪的多用途低开销框架
Pubname: IEEE Robotics and Automation Letters
FirstAuthor: Christophe Bédard
allAuthors:
  - Christophe Bédard
  - " Ingo Lütkebohle"
  - " Michel Dagenais"
Pubdate: 2022-07
DOI: https://doi.org/10.1109/LRA.2022.3174346
zoterolink: zotero://select/library/items/F6IIGQXX
$version: 38987
$libraryID: 1
$itemKey: DVM2A4PB
<<<<<<< HEAD
created: 2024-07-25T16:21
updated: 2024-07-25T16:23
=======
created: 2024-07-24T16:45
updated: 2024-07-24T20:59
>>>>>>> origin/main
---
# ros2\_tracing: Multipurpose Low-Overhead Framework for Real-Time Tracing of ROS 2

# 摘要

由于高系统复杂性和动态环境，测试和调试已成为机器人软件开发的主要障碍。标准的、基于中间件的数据记录不能提供有关内部计算和性能瓶颈的足够信息。其他现有方法也针对非常具体的问题，因此不能用于多用途分析。此外，它们不适合实时应用。在本文中，我们介绍了 ros2\_tracing，它是 ROS 2 的灵活跟踪工具和多用途仪器的集合。它允许使用低开销的 LTTng 跟踪器收集实时分布式系统上的运行时执行信息。工具还将跟踪集成到宝贵的 ROS 2 编排系统和其他可用性工具中。消息延迟实验表明，启用所有 ROS 2 工具时，端到端消息延迟开销平均为 0.0033 毫秒，我们认为这适合生产实时系统。使用 ros2\_tracing 获得的 ROS 2 执行信息可以与来自操作系统的跟踪数据相结合，从而实现更广泛的精确分析，有助于了解应用程序的执行情况，找到性能瓶颈和其他问题的原因。源代码位于：https\://github.com/ros2/ros2tracing。

# \[color]ros2\_tracing: Multipurpose Low-Overhead Framework for Real-Time Tracing of ROS 2

## <span style="background-color: #ff666680">贡献/结果 Annotations</span>

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22R77P9GRA%22%2C%22color%22%3A%22%23ff6666%22%2C%22pageLabel%22%3A%221%22%2C%22position%22%3A%7B%22pageIndex%22%3A0%2C%22rects%22%3A%5B%5B332%2C143.193%2C563.033%2C151.831%5D%2C%5B332%2C131.238%2C563.033%2C139.876%5D%2C%5B332%2C119.283%2C361.938%2C127.921%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%221%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=1&#x26;annotation=R77P9GRA">“It offers extensible tracing instrumentation capable of providing execution information on multiple facets of ROS 2.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%221%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 1</a></span>)</span> 🔤它提供可扩展的跟踪工具，能够提供 ROS 2 多个方面的执行信息。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22BAASK8VJ%22%2C%22color%22%3A%22%23ff6666%22%2C%22pageLabel%22%3A%221%22%2C%22position%22%3A%7B%22pageIndex%22%3A0%2C%22rects%22%3A%5B%5B332%2C107.327%2C563.033%2C115.965%5D%2C%5B332%2C95.372%2C563.033%2C104.01%5D%2C%5B332%2C83.417%2C563.033%2C92.055%5D%2C%5B332%2C71.462%2C517.533%2C80.1%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%221%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=1&#x26;annotation=BAASK8VJ">“With a strategic two-phase instrumentation design and using a low-overhead tracer, it has a lower runtime overhead than current solutions, making it suitable for the real-time applications targeted by ROS 2.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%221%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 1</a></span>)</span> 🔤它采用战略性两阶段仪器设计并使用低开销跟踪器，其运行时开销比当前解决方案更低，使其适合 ROS 2 所针对的实时应用程序。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22UADJK2MD%22%2C%22color%22%3A%22%23ff6666%22%2C%22pageLabel%22%3A%222%22%2C%22position%22%3A%7B%22pageIndex%22%3A1%2C%22rects%22%3A%5B%5B68.986%2C725.41%2C249.588%2C734.048%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%222%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=2&#x26;annotation=UADJK2MD">“userspace and kernel space data as a whole.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%222%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 2</a></span>)</span> 用户空间和内核空间数据作为一个整体。\
🔤用户空间和内核空间数据作为一个整体。🔤

## <span style="background-color: #5fb23680">模型 Annotations</span>

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22LKAE55PE%22%2C%22color%22%3A%22%235fb236%22%2C%22pageLabel%22%3A%223%22%2C%22position%22%3A%7B%22pageIndex%22%3A2%2C%22rects%22%3A%5B%5B58.927%2C103.741%2C300.022%2C112.379%5D%2C%5B48.964%2C91.786%2C300.022%2C100.424%5D%2C%5B48.964%2C79.831%2C300.022%2C88.469%5D%2C%5B48.964%2C67.875%2C300.022%2C76.513%5D%2C%5B48.964%2C55.92%2C300.022%2C64.558%5D%2C%5B48.964%2C43.965%2C128.197%2C52.603%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%223%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=3&#x26;annotation=LKAE55PE">“As shown in Fig. 2, core ROS 2 packages are instrumented with function calls to the tracetools package. This package provides tracepoints for all of ROS 2 and is the one that triggers them. Tracepoints usually act as instrumentation points and could be directly added to the instrumented code.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%223%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 3</a></span>)</span> 🔤如图 2 所示，核心 ROS 2 包通过对 Tracetools 包的函数调用进行检测。该软件包为所有 ROS 2 提供跟踪点，并且是触发它们的跟踪点。跟踪点通常充当检测点，可以直接添加到检测代码中。🔤

## <span style="background-color: #2ea8e580">背景 Annotations</span>

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22XWIZG98W%22%2C%22color%22%3A%22%232ea8e5%22%2C%22pageLabel%22%3A%222%22%2C%22position%22%3A%7B%22pageIndex%22%3A1%2C%22rects%22%3A%5B%5B311.978%2C299.636%2C563.036%2C308.274%5D%2C%5B311.978%2C287.681%2C423.988%2C296.319%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%222%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=2&#x26;annotation=XWIZG98W">“As of ROS 2 Galactic Geochelone, the default middleware is Eclipse Cyclone DDS [24].”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%222%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 2</a></span>)</span> 🔤从 ROS 2 Gactic Geochelone 开始，默认中间件是 Eclipse Cyclone DDS \[24]。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22HM4JKDLX%22%2C%22color%22%3A%22%232ea8e5%22%2C%22pageLabel%22%3A%222%22%2C%22position%22%3A%7B%22pageIndex%22%3A1%2C%22rects%22%3A%5B%5B321.94%2C67.875%2C563.035%2C76.513%5D%2C%5B311.978%2C55.92%2C563.036%2C64.558%5D%2C%5B311.978%2C43.964%2C563.036%2C52.602%5D%5D%2C%22nextPageRects%22%3A%5B%5B48.964%2C725.4100784%2C300.02152%2C734.0476526%5D%2C%5B48.964%2C713.4540784%2C300.0215200000001%2C722.0916526%5D%2C%5B48.964%2C701.4990783999999%2C300.02152%2C710.1366525999999%5D%2C%5B48.964%2C689.5440783999999%2C300.0215200000001%2C698.1816525999999%5D%2C%5B48.964%2C677.5890783999998%2C300.02152%2C686.2266525999999%5D%2C%5B48.964%2C665.6340783999998%2C258.68669260000013%2C674.2716525999998%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%222%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=2&#x26;annotation=HM4JKDLX">“As for the code, in ROS, it is generally split into multiple packages, which directly and indirectly depend on other packages. Each package has a specific purpose and may provide multiple libraries and executables, with each executable containing any number of nodes. The ROS ecosystem is federated: packages are spread across multiple code repositories, on various hosts, and are authored and maintained by different people. The ROS 2 source code itself is made up of multiple packages that approximately match its architecture.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%222%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 2</a></span>)</span> 🔤至于代码，在ROS中，一般会被拆分成多个包，这些包直接或间接依赖于其他包。每个包都有特定的用途，并且可以提供多个库和可执行文件，每个可执行文件包含任意数量的节点。 ROS 生态系统是联合的：包分布在多个代码存储库、不同的主机上，并由不同的人编写和维护。 ROS 2 源代码本身由多个与其架构大致匹配的包组成。🔤

## <span style="background-color: #e56eee80">参考/学习 Annotations</span>

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22H5P6Q64Y%22%2C%22color%22%3A%22%23e56eee%22%2C%22pageLabel%22%3A%225%22%2C%22position%22%3A%7B%22pageIndex%22%3A4%2C%22rects%22%3A%5B%5B110.304%2C573.853%2C300.022%2C582.491%5D%2C%5B48.964%2C561.897%2C300.022%2C570.535%5D%2C%5B48.964%2C549.942%2C300.022%2C558.58%5D%2C%5B48.964%2C537.987%2C300.022%2C546.625%5D%2C%5B48.964%2C526.032%2C300.022%2C534.67%5D%2C%5B48.964%2C514.077%2C300.022%2C522.715%5D%2C%5B48.964%2C502.122%2C300.022%2C510.76%5D%2C%5B48.964%2C490.166%2C300.022%2C498.804%5D%2C%5B48.964%2C478.211%2C300.027%2C486.849%5D%2C%5B48.964%2C466.256%2C177.79%2C474.894%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=5&#x26;annotation=H5P6Q64Y">“For example, we traced a ROS 2 system that simulates a real-world autonomous driving scenario [27]. In this example, a node receives data from 6 different topics using subscriptions. When the subscriptions receive a new message, they cache it so that the node only keeps the latest message for each topic. The periodically-triggered callback uses the latest message from each topic to compute a result and publish it. To analyze the trace data, we wrote a simple script using tracetools_analysis [28], a Python library to read and analyze trace data.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 5</a></span>)</span> 🔤例如，我们追踪了一个模拟现实世界自动驾驶场景的 ROS 2 系统 \[27]。在此示例中，节点使用订阅从 6 个不同主题接收数据。当订阅收到新消息时，它们会将其缓存，以便节点仅保留每个主题的最新消息。定期触发的回调使用每个主题的最新消息来计算结果并将其发布。为了分析跟踪数据，我们使用tracetools\_analysis \[28]（一个用于读取和分析跟踪数据的Python 库）编写了一个简单的脚本。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22B8GBYHKC%22%2C%22color%22%3A%22%23e56eee%22%2C%22pageLabel%22%3A%225%22%2C%22position%22%3A%7B%22pageIndex%22%3A4%2C%22rects%22%3A%5B%5B311.978%2C175.472%2C563.036%2C184.11%5D%2C%5B311.978%2C163.517%2C563.036%2C172.155%5D%2C%5B311.978%2C151.561%2C563.036%2C160.199%5D%2C%5B311.978%2C139.606%2C563.036%2C148.244%5D%2C%5B311.978%2C127.651%2C563.036%2C136.289%5D%2C%5B311.978%2C115.696%2C379.006%2C124.334%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=5&#x26;annotation=B8GBYHKC">“In this example, a multi-threaded executor was used, with the number of threads being equal to the number of logical CPU cores by default. Since this was not the only application running on the system at that time, multiple processes and threads were competing for CPU, as can be observed using Trace Compass.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 5</a></span>)</span> 🔤本例中使用了多线程执行器，默认线程数等于逻辑CPU核心数。由于这不是当时系统上运行的唯一应用程序，因此多个进程和线程正在竞争 CPU，这一点可以使用 Trace Compass 观察到。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%225YN9HVS2%22%2C%22color%22%3A%22%23e56eee%22%2C%22pageLabel%22%3A%226%22%2C%22position%22%3A%7B%22pageIndex%22%3A5%2C%22rects%22%3A%5B%5B58.927%2C460.601%2C300.027%2C469.239%5D%2C%5B48.964%2C448.645%2C300.022%2C457.283%5D%2C%5B48.964%2C436.69%2C300.022%2C445.328%5D%2C%5B48.964%2C424.735%2C300.022%2C433.373%5D%2C%5B48.964%2C412.78%2C300.022%2C421.418%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=6&#x26;annotation=5YN9HVS2">“Since the ros2_tracing tracepoints are placed along the message publication and reception pipeline, an easy way to capture the maximum overhead is to measure the time between publishing a message and when it is handled by the subscription callback. This is what we will do in the following.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 6</a></span>)</span> 🔤由于 ros2\_tracing 跟踪点沿着消息发布和接收管道放置，捕获最大开销的一个简单方法是测量发布消息和订阅回调处理消息之间的时间。这就是我们接下来要做的事情。🔤

## <span style="background-color: #f1983780">方法/实验 Annotations</span>

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22V5PYT6WW%22%2C%22color%22%3A%22%23f19837%22%2C%22pageLabel%22%3A%225%22%2C%22position%22%3A%7B%22pageIndex%22%3A4%2C%22rects%22%3A%5B%5B338.71%2C537.048%2C563.036%2C543.959%5D%2C%5B311.978%2C528.082%2C563.036%2C534.993%5D%2C%5B311.978%2C519.116%2C473.986%2C526.027%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=5&#x26;annotation=V5PYT6WW">“Example timer callback execution interval (top) and duration (bottom) over time. The callback period is set to 100 ms, while the callback duration depends on the work done. Both contain outliers.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 5</a></span>)</span> 🔤随着时间的推移，计时器回调执行间隔（顶部）和持续时间（底部）示例。回调周期设置为 100 毫秒，回调持续时间取决于完成的工作。两者都包含异常值。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22Z7HH2KS4%22%2C%22color%22%3A%22%23f19837%22%2C%22pageLabel%22%3A%225%22%2C%22position%22%3A%7B%22pageIndex%22%3A4%2C%22rects%22%3A%5B%5B514.229%2C426.53%2C563.036%2C435.168%5D%2C%5B311.978%2C414.575%2C563.036%2C423.213%5D%2C%5B311.978%2C402.62%2C563.036%2C411.258%5D%2C%5B311.978%2C390.665%2C563.036%2C399.303%5D%2C%5B311.978%2C378.71%2C563.036%2C387.348%5D%2C%5B311.978%2C366.755%2C563.036%2C375.393%5D%2C%5B311.978%2C354.799%2C563.036%2C363.437%5D%2C%5B311.978%2C342.844%2C563.036%2C351.482%5D%2C%5B311.978%2C330.889%2C404.999%2C339.527%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=5&#x26;annotation=Z7HH2KS4">“The ROS 2 trace data that was obtained using the ros2_tracing instrumentation can be analyzed together with the OS trace data using Eclipse Trace Compass [29], which is an open-source trace viewer and framework aimed towards performance and reliability analysis. Trace Compass can analyze Linux kernel data to show the frequency and state of CPUs over time, including interrupts, system calls, or userspace processes executing on each CPU.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 5</a></span>)</span> 🔤使用 ros2\_tracing 仪器获得的 ROS 2 跟踪数据可以使用 Eclipse Trace Compass \[29] 与操作系统跟踪数据一起进行分析，Eclipse Trace Compass 是一个开源跟踪查看器和框架，旨在进行性能和可靠性分析。 Trace Compass 可以分析 Linux 内核数据，以显示 CPU 随时间变化的频率和状态，包括中断、系统调用或每个 CPU 上执行的用户空间进程。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%225P6AQQPM%22%2C%22color%22%3A%22%23f19837%22%2C%22pageLabel%22%3A%225%22%2C%22position%22%3A%7B%22pageIndex%22%3A4%2C%22rects%22%3A%5B%5B377.761%2C247.203%2C563.036%2C255.841%5D%2C%5B311.978%2C235.248%2C563.036%2C243.886%5D%2C%5B311.978%2C223.292%2C563.036%2C231.93%5D%2C%5B311.978%2C211.337%2C563.036%2C219.975%5D%2C%5B311.978%2C199.382%2C563.036%2C208.02%5D%2C%5B311.978%2C187.427%2C563.036%2C196.065%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=5&#x26;annotation=5P6AQQPM">“Finding the timestamps of the corresponding ROS 2 events in Trace Compass, we see that the thread was blocked waiting for CPU for 9.9 ms before the aforementioned callback instance. The thread then had to query the middleware for new messages (even if timers are strictly handled at the ROS 2 level) and finally call the overdue timer callback.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%225%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 5</a></span>)</span> 🔤在 Trace Compass 中查找相应 ROS 2 事件的时间戳，我们发现线程在上述回调实例之前被阻塞等待 CPU 9.9 毫秒。然后，线程必须向中间件查询新消息（即使计时器严格在 ROS 2 级别处理），最后调用逾期计时器回调。🔤

![image.png](https://raw.githubusercontent.com/wsm6636/pic/main/202407251623009.png)

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%226LM54I5I%22%2C%22color%22%3A%22%23f19837%22%2C%22pageLabel%22%3A%226%22%2C%22position%22%3A%7B%22pageIndex%22%3A5%2C%22rects%22%3A%5B%5B76.572%2C671.156%2C563.036%2C678.067%5D%2C%5B48.964%2C662.031%2C563.039%2C669.853%5D%2C%5B48.964%2C653.065%2C563.036%2C660.887%5D%2C%5B48.964%2C644.256%2C563.035%2C651.167%5D%2C%5B48.964%2C635.132%2C563.035%2C642.954%5D%2C%5B48.964%2C626.324%2C116.734%2C633.235%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=6&#x26;annotation=6LM54I5I">“State of ROS 2 application threads over time with timestamps of ROS 2 events from the ros2_tracing instrumentation displayed as small triangles on top of the thread state rectangle: ©1 thread waiting for CPU for 9.9 ms (orange), ©2 thread running (green), ©3 event marking start of middleware query &#x26; wait for new messages, ©4 event marking end of middleware query, and ©5 rclcpp_executor_execute event followed shortly after by callback_start event for timer callback. This result was obtained by importing trace data collected from the Linux kernel and from the ROS 2 application using LTTng into Trace Compass [29]. The black arrow to the left of 3© represents the scheduling switch from one thread to another for a given CPU. Some less relevant threads were hidden.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 6</a></span>)</span> 🔤ROS 2 应用程序线程随时间的状态，以及来自 ros2\_tracing 检测的 ROS 2 事件的时间戳，在线程状态矩形顶部显示为小三角形：©1 线程等待 CPU 9.9 毫秒（橙色），©2 线程正在运行（绿色） ，©3 事件标记中间件查询开始并等待新消息，©4 事件标记中间件查询结束，以及©5 rclcpp\_executor\_execute 事件，紧随其后的是用于计时器回调的callback\_start 事件。该结果是通过使用 LTTng 将从 Linux 内核和 ROS 2 应用程序收集的跟踪数据导入到 Trace Compass \[29] 中获得的。 3© 左侧的黑色箭头表示给定 CPU 从一个线程到另一个线程的调度切换。一些不太相关的线程被隐藏了。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22TH6DQHFV%22%2C%22color%22%3A%22%23f19837%22%2C%22pageLabel%22%3A%226%22%2C%22position%22%3A%7B%22pageIndex%22%3A5%2C%22rects%22%3A%5B%5B58.927%2C199.382%2C300.022%2C208.02%5D%2C%5B48.964%2C187.427%2C300.022%2C196.065%5D%2C%5B48.964%2C175.472%2C300.022%2C184.11%5D%2C%5B48.964%2C163.517%2C300.022%2C172.155%5D%2C%5B48.964%2C151.562%2C244.261%2C160.2%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=6&#x26;annotation=TH6DQHFV">“To reduce measurement variability, we follow common practice by using a kernel patched with the PREEMPT RT patch (5.4.3-rt1), disabling simultaneous multithreading, and disabling power-saving features in the BIOS (dynamic frequency scaling, C-states, Turbo Boost, etc.).”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 6</a></span>)</span> 🔤为了减少测量变异性，我们遵循常见做法，使用用 PREEMPT RT 补丁 (5.4.3-rt1) 修补的内核，禁用同时多线程，并禁用 BIOS 中的省电功能（动态频率缩放、C 状态、Turbo）升压等）。🔤

<span class="highlight" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FU68SQLMG%22%2C%22annotationKey%22%3A%22QY8WGCZL%22%2C%22color%22%3A%22%23f19837%22%2C%22pageLabel%22%3A%226%22%2C%22position%22%3A%7B%22pageIndex%22%3A5%2C%22rects%22%3A%5B%5B483.345%2C583.341%2C525.706%2C591.979%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%7D" ztype="zhighlight"><a href="zotero://open-pdf/library/items/U68SQLMG?page=6&#x26;annotation=QY8WGCZL">“Fast DDS.”</a></span> <span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F8765952%2Fitems%2FF6IIGQXX%22%5D%2C%22locator%22%3A%226%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/F6IIGQXX">Bédard 等, 2022, p. 6</a></span>)</span> 🔤快速 DDS。🔤

# 笔记

## 1 论文创新在于

## 2 解决了什么问题

## 3 方法

## 4 不足&可继续研究

## 5 可参考

## 6 思考
