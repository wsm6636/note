---
created: 2023-07-08T20:32
updated: 2024-03-26T23:32
tags:
  - 笔记
  - 笔记/项目
---

# rtbubbles实现

## 实现思路

![image-20230215154617616](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302151546749.png)

## 多任务实现思路

1、初始化方面（包括模块初始化以及文件注册）

​		1）根据任务数量，增加相关数据结构的大小

​				如tinfo的size

​		2）增加注册多个字符驱动设备文件，注册文件编号与任务相对应，以便为测试任务配置相应的读写路径

​				单任务实现中，只有一个注册文件，并固定为/dev/mychar0

​				多任务实现中，增加编号/dev/mychar0，/dev/mychar1，/dev/mychar2……

​				**rtbubbles_init_fs函数中**

![image-20230215161554549](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302151615626.png)



​		3）增加多个任务参数的初始化，如周期、文件操作等

​				模块中任务的顺序和参数，与测试程序的顺序和参数一一对应

​				**mod_init函数中**

![image-20230215161744413](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302151617472.png)

​			例如，task1在模块和测试中，都是第二个（以0,1,2,3……的顺序），且周期截止期等参数一致，其对应的数据读写路径为/dev/mychar1

2、数据读写方面

​		在单任务的基础上，增加对于任务编号的判断，让不同截止期的任务能在对应的时间wakeup

​		**ioctl函数中**

![image-20230215162042413](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302151620474.png)

3、定时器回调中

​		从单任务扩展为多任务轮询，并对唤醒的任务执行相关更新操作

​		**period_callback函数中**

![image-20230215162514791](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302151625853.png)

​		对异常的判断，也从单任务变成多任务轮询

4、模块卸载

​		根据任务数量增加的相关数据结构和文件，一一注销释放

5、测试方面

​		测试脚本，添加多个任务的参数设定，并编译出相应程序

​		![image-20230215163010523](https://cdn.jsdelivr.net/gh/wsm6636/pic/202302151630597.png)

​		结果分析脚本同理，增加多个任务的处理命令